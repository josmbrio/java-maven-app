#!/usr/bin/env groovy

pipeline {
        agent any
        
        stages {
            stage("build app") {
                steps {
                    script {
                        echo "building the application"
                    }
                }
            }
            stage("build image") {
                steps {
                    script {
                        echo "building the application"
                        
                    }
                }
            }
            stage("deploy") {
                steps {
                    script {
                        echo 'deploying the application...'

                        def dockerCmd = 'docker run -p 3000:3080 -d josmbrio/my-repo:rne-1.0'
                        sshagent(['ec2-server-key']) {
                            sh "ssh -o StrictHostKeyChecking=no ec2-user@174.129.85.192	${dockerCmd}"
                        }
                    }
                }
            }
        }
}
